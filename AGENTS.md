# 一、AI 执行总原则（最高优先级）

## 1.1 基础原则

1. 一致性优先 > 创新
2. 稳定性优先 > 优雅
3. 可读性优先 > 技巧
4. 最小改动优先 > 重构
5. 安全优先 > 便捷

------

## 1.2 AI 输出前强制步骤

AI 在生成代码前必须：

- ✅ 说明对业务的理解
- ✅ 明确修改范围
- ✅ 说明是否新增类
- ✅ 说明是否新增字段
- ✅ 说明是否涉及事务
- ❌ 禁止直接大段输出代码

------

## 1.3 决策原则

当规则与现有代码冲突时：

> 以现有代码风格为最高优先级

------

# 二、技术栈强约束（不可突破）

## 2.1 固定技术栈

| 分类   | 技术                  |
| ------ | --------------------- |
| 语言   | Java 8+               |
| 框架   | Spring Boot           |
| ORM    | MyBatis-Plus          |
| 数据库 | MySQL8 / KingbaseV8R6 |
| 缓存   | Redis                 |
| 鉴权   | JWT                   |
| 构建   | Maven                 |

------

## 2.2 严禁行为

- ❌ 引入 JPA / Hibernate
- ❌ 升级 JDK 大版本
- ❌ 引入响应式编程
- ❌ 引入微服务拆分
- ❌ 引入架构级重构
- ❌ 使用未知第三方工具类

如确实需要新增技术：

必须说明：

1. 为什么当前方案无法满足
2. 风险评估
3. 替代方案对比

否则禁止使用。

------

# 三、分层结构强制规范

## 3.1 标准分层

```
Controller
   ↓
Service
   ↓
Entity
   ↓
Mapper
```

------

## 3.2 禁止跨层调用

- ❌ Controller 调 Mapper
- ❌ Mapper 调 Service
- ❌ Entity 依赖 Spring 组件

------

## 3.3 各层职责

### Controller

仅允许：

- 参数接收
- 参数校验
- 权限校验
- 调用 Service

禁止：

- 业务逻辑
- 数据库逻辑
- 复杂判断流程

------

### Service

职责：

- 业务流程编排
- 状态流转校验
- 事务控制
- 调用多个 Mapper

要求：

- 写操作必须加 `@Transactional`
- 不允许吞异常
- 统一抛业务异常

------

### Mapper

职责：

- 纯数据库访问
- 不封装业务对象
- 不写复杂判断逻辑

------

# 四、对象使用强制规范

## 4.1 类型职责

| 类型   | 用途       |
| ------ | ---------- |
| DTO    | 接口入参   |
| Entity | 数据库映射 |
| VO     | 接口出参   |

------

## 4.2 强制规则

- ❌ Entity 禁止作为接口返回
- ❌ DTO 禁止直接入库
- ❌ VO 禁止入库
- ✅ 必须存在 Converter 层

转换流程必须明确：

```
DTO → Entity
Entity → VO
```

------

# 五、命名与代码风格规范

## 5.1 包名

- 全小写
- 按业务域拆分
- 基础包结构固定：

```
controller
service
service.impl
pojo
pojo.entity
pojo.dto
pojo.vo
pojo.response
mapper
```

------

## 5.2 类名规则

格式：

```
模块缩写 + 业务 + 职责
```

示例：

```
QOOrderService
QOOrderEntity
QOOrderQueryDTO
QOOrderVO
```

------

## 5.3 方法命名

必须动词开头：

- addXxx
- updateXxx
- deleteXxx
- getXxx
- listXxx

禁止：

- doXxx
- handleXxx
- processXxx

------

## 5.4 变量命名

禁止：

```
tmp
obj
data
cnt
```

必须语义明确：

```
orderCount
orderEntity
userStatus
```

------

# 六、注释规范

## 6.1 类注释（必写）

```
/**
 * 订单创建服务
 *
 * 负责订单创建、校验及初始化逻辑
 * @author tztang
 */
```

------

## 6.2 方法注释（对外方法必写）

```
/**
 * 创建订单
 *
 * @param command 创建订单参数
 * @return 订单ID
 */
```

------

## 6.3 行内注释

- 只解释“为什么”
- 不解释显而易见代码

------

# 七、代码书写规范

1. 大方法之间必须空一行
2. 类、接口、方法、参数首尾必须空一行
3. 使用 `@Resource`，禁止 `@Autowired`
4. `@RequestMapping` 必须提取公共路径
5. 注解排序：
   - 先按功能分组
   - 再按长度排序
6. 默认使用 POST 请求
7. 所有的分页查询的XXXVO都要继承PageDTO

------

# 八、SQL 强制规范

## 8.1 查询规则

- ❌ 禁止 SELECT *
- 必须明确字段
- 必须使用 `<where>`
- 入参必须判断为空
- 批量查询必须分页

------

## 8.2 表设计强制字段

- id
- create_time
- update_time
- is_del

------

# 九、异常与返回规范

## 9.1 异常规则

必须：

```
throw new CustomException(OrderErrorCode.ORDER_STATUS_INVALID);
```

禁止：

```
throw new RuntimeException();
```

------

## 9.2 错误码格式

```
QO-模块-编号
```

示例：

```
QO-ORDER-001
QO-ORDER-002
```

------

# 十、AI 行为约束（核心）

## 10.1 AI 必须遵守

- 先解释设计，再写代码
- 优先复用现有类
- 不确定时提出设计建议
- 默认写可测试代码
- 说明事务边界
- 不省略空行规范

------

## 10.2 AI 严禁行为

- ❌ 臆测数据库结构
- ❌ 编造不存在工具类
- ❌ 擅自重构未要求模块
- ❌ 输出超长无解释代码
- ❌ 改变架构风格

------

# 十一、AI 输出格式规范（强制）

AI 必须按顺序输出：

```
1. 业务理解
2. 设计说明
3. 修改点说明
4. 代码实现
5. 影响范围说明
```

------

# 十二、适用范围

本规范适用于：

- AI 生成代码
- AI 重构代码
- AI 代码评审
